// -*- mode: c++ -*-

//
// project stormbreak
// author Maximilien M. Cura
//

#ifndef __STB_UI
#define __STB_UI

#include <Pewter/Color>
#include <Pewter/Display>
#include <Pewter/Glyph>
#include <Pewter/Input>
#include <Pewter/Engines/TTY/TTY>
#include <Pewter/Input>

#include <STB/Logging>

#include <queue>

namespace STB {
    extern pewter::engine::tty::TTY * tty;
    extern pewter::engine::tty::TTYRenderer * tty_renderer;

    typedef vnz::math::_i64 MenuChoice;

    struct Menu
    {
        struct Item
        {
            const char * item_label;
            const MenuChoice item_choice;
            const char item_selector;
            const bool item_enabled;
        };

        const char * menu_title;
        std::vector<Item> menu_items;

        Menu (const char *);
        Menu & item (const char *, MenuChoice, char = ' ', bool = true);
    };

    struct MenuUI
    {
        pewter::Layer menu_layer;
        pewter::Display & display;

        MenuUI (pewter::Rect<pewter::DisplayCoord>, pewter::Display &);
        void ui_sizechange (pewter::Rect<pewter::DisplayCoord>);

        MenuChoice ui_menu (Menu);
    };

    struct Notice
    {
        const char * notice_string;
    };

    struct NoticeHistory
    {
        std::deque<Notice> history;
        Logger logger;

        NoticeHistory (const char * backing_file);
        // Save all remaining notices to the backing file
        ~NoticeHistory ();

        void push_notice (Notice notice);
        void pop_notice_to_backing_file ();
    };

    struct NoticeQueue
    {
        std::queue<Notice> notices;
        vnz::math::_usize notice_index;

        void clear_queue ();
        const char * pull_characters (vnz::math::_usize);
    };

    struct NoticeUI
    {
        pewter::Layer notice_layer;

        NoticeQueue notice_queue;
        NoticeHistory notice_history;

        void ui_sizechange (pewter::Rect<pewter::DisplayCoord>);
        void ui_display_as_line ();
        void ui_display_as_pane ();
    };

    // no string input yet...
}

#endif /* !@__STB_UI */
